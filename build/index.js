var e=require("jszip"),t=require("tweetnacl"),n=require("tweetnacl-util"),r=require("@ethersproject/contracts"),o=require("@ethersproject/wallet"),a=require("@ethersproject/providers"),i=require("@metamask/detect-provider");require("eth-object");var s=require("eth-util-lite"),c=require("protons"),u=require("multihashing"),l=require("cids"),d=require("libp2p"),p=require("libp2p-websockets"),f=require("@lit-protocol/libp2p-webrtc-direct"),y=require("libp2p-noise"),m=require("libp2p/src/transport-manager"),h=require("libp2p-mplex"),g=require("libp2p-kad-dht"),v=require("peer-id");require("multiaddr");var b=require("libp2p-bootstrap"),w=require("it-pipe");require("it-length-prefixed"),require("it-pushable");var k=require("secrets.js-lit"),P=require("uint8arrays/from-string"),T=require("uint8arrays/to-string"),E=require("it-all");function S(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var I=S(e),A=S(t),x=S(n),L=S(i),K=S(c),N=S(u),F=S(l),C=S(d),j=S(p),R=S(f),B=S(h),_=S(g),M=S(v),U=S(b),q=S(w),O=S(k),D=S(P),G=S(T),H=S(E);!function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=Object.create((t&&t.prototype instanceof h?t:h).prototype),a=new x(r||[]);return o._invoke=function(e,t,n){var r=d;return function(o,a){if(r===f)throw new Error("Generator is already running");if(r===y){if("throw"===o)throw a;return K()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var s=S(i,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?y:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=y,n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",p="suspendedYield",f="executing",y="completed",m={};function h(){}function g(){}function v(){}var b={};b[a]=function(){return this};var w=Object.getPrototypeOf,k=w&&w(w(L([])));k&&k!==n&&r.call(k,a)&&(b=k);var P=v.prototype=h.prototype=Object.create(b);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){function n(o,a,i,s){var c=l(e[o],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,i,s)},function(e){n("throw",e,i,s)}):t.resolve(d).then(function(e){u.value=e,i(u)},function(e){return n("throw",e,i,s)})}s(c.arg)}var o;this._invoke=function(e,r){function a(){return new t(function(t,o){n(e,r,t,o)})}return o=o?o.then(a,a):a()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=l(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function L(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:K}}function K(){return{value:t,done:!0}}return g.prototype=P.constructor=v,v.constructor=g,g.displayName=c(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,s,"GeneratorFunction")),e.prototype=Object.create(P),e},e.awrap=function(e){return{__await:e}},T(E.prototype),E.prototype[i]=function(){return this},e.AsyncIterator=E,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new E(u(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})},T(P),c(P,s,"Generator"),P[a]=function(){return this},P.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;A(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}({});try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}();var J={name:"AES-CBC",length:256};function W(e,t,n){switch(n){case"x25519-xsalsa20-poly1305":var r,o=A.default.box.keyPair();try{r=x.default.decodeBase64(e)}catch(e){throw new Error("Bad public key")}var a=x.default.decodeUTF8(t),i=A.default.randomBytes(A.default.box.nonceLength),s=A.default.box(a,i,r,o.secretKey);return{version:"x25519-xsalsa20-poly1305",nonce:x.default.encodeBase64(i),ephemPublicKey:x.default.encodeBase64(o.publicKey),ciphertext:x.default.encodeBase64(s)};default:throw new Error("Encryption type/version not supported")}}function Y(e,t){switch(e.version){case"x25519-xsalsa20-poly1305":var n,r=x.default.decodeBase64(t),o=x.default.decodeBase64(e.nonce),a=x.default.decodeBase64(e.ciphertext),i=x.default.decodeBase64(e.ephemPublicKey),s=A.default.box.open(a,o,i,r);try{n=x.default.encodeUTF8(s)}catch(e){throw new Error("Decryption failed.  Could not encode result as utf8")}if(n)return n;throw new Error("Decryption failed.  Output is falsy");default:throw new Error("Encryption type/version not supported.")}}var V=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"userAddress",type:"address"},{indexed:!1,internalType:"address payable",name:"relayerAddress",type:"address"},{indexed:!1,internalType:"bytes",name:"functionSignature",type:"bytes"}],name:"MetaTransactionExecuted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256[]",name:"ids",type:"uint256[]"},{indexed:!1,internalType:"uint256[]",name:"values",type:"uint256[]"}],name:"TransferBatch",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"id",type:"uint256"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"TransferSingle",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"value",type:"string"},{indexed:!0,internalType:"uint256",name:"id",type:"uint256"}],name:"URI",type:"event"},{inputs:[],name:"ERC712_VERSION",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"id",type:"uint256"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"address[]",name:"accounts",type:"address[]"},{internalType:"uint256[]",name:"ids",type:"uint256[]"}],name:"balanceOfBatch",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"address",name:"userAddress",type:"address"},{internalType:"bytes",name:"functionSignature",type:"bytes"},{internalType:"bytes32",name:"sigR",type:"bytes32"},{internalType:"bytes32",name:"sigS",type:"bytes32"},{internalType:"uint8",name:"sigV",type:"uint8"}],name:"executeMetaTransaction",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"payable",type:"function",payable:!0},{inputs:[],name:"getChainId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function",constant:!0},{inputs:[],name:"getDomainSeperator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getNonce",outputs:[{internalType:"uint256",name:"nonce",type:"uint256"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256[]",name:"ids",type:"uint256[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeBatchTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"id",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function",constant:!0},{inputs:[],name:"tokenIds",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"uri",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"uint256",name:"quantity",type:"uint256"}],name:"mint",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"isOperator",type:"bool"}],stateMutability:"view",type:"function",constant:!0},{inputs:[{internalType:"bool",name:"enabled",type:"bool"}],name:"setOpenseaProxyEnabled",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newAdmin",type:"address"}],name:"changeAdmin",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"uri",type:"string"}],name:"setURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAdmin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function",constant:!0}],z=K.default("\nmessage Request {\n  enum Type {\n    HANDSHAKE = 0;\n    GET_KEY_FRAGMENT = 1;\n    STORE_KEY_FRAGMENT = 2;\n  }\n  required Type type = 1;\n  optional GetKeyFragment getKeyFragment = 2;\n  optional StoreKeyFragment storeKeyFragment = 3;\n  optional bytes authSig = 4;\n  optional TokenParams tokenParams = 5;\n  optional bytes clientPubKey = 6;\n  optional bytes merkleProof = 7;\n}\nmessage Response {\n  enum Type {\n    HANDSHAKE_RESPONSE = 0;\n    GET_KEY_FRAGMENT_RESPONSE = 1;\n    STORE_KEY_FRAGMENT_RESPONSE = 2;\n  }\n  required Type type = 1;\n  optional GetKeyFragmentResponse getKeyFragmentResponse = 2;\n  optional StoreKeyFragmentResponse storeKeyFragmentResponse = 3;\n  optional bytes serverPubKey = 4;\n}\nmessage GetKeyFragment {\n  required bytes keyId = 1;\n}\nmessage GetKeyFragmentResponse {\n  enum Result {\n    SUCCESS = 0;\n    NOT_FOUND = 1;\n    AUTH_FAILURE = 2;\n    ERROR = 3;\n  }\n  required Result result = 1;\n  optional bytes keyId = 2;\n  optional bytes fragmentValue = 3;\n}\nmessage StoreKeyFragment {\n  required bytes fragmentValue = 1;\n  required bytes fragmentNumber = 2;\n}\nmessage StoreKeyFragmentResponse {\n  enum Result {\n    SUCCESS = 0;\n    AUTH_FAILURE = 1;\n    ERROR = 2;\n  }\n  required Result result = 1;\n  optional bytes errorMessage = 2;\n}\nmessage TokenParams {\n  required bytes tokenAddress = 1;\n  required bytes tokenId = 2;\n  required bytes chain = 3;\n}\n"),Q={polygon:{contractAddress:"0xb9A323711528D0c5a70df790929f4739f1cDd7fD",chainId:137,name:"Polygon",symbol:"MATIC",decimals:18,rpcUrls:["https://floral-rough-flower.matic.quiknode.pro/a17b25f97cc396bb2b6aaf85a005f579bf93dc73/"],blockExplorerUrls:["https://explorer.matic.network"],balanceStorageSlot:1,type:"ERC1155",websocketUrl:"wss://floral-rough-flower.matic.quiknode.pro/a17b25f97cc396bb2b6aaf85a005f579bf93dc73/"},fantom:{contractAddress:"0x3110c39b428221012934A7F617913b095BC1078C",chainId:250,name:"Fantom",symbol:"FTM",decimals:18,rpcUrls:["https://rpcapi.fantom.network"],blockExplorerUrls:["https://ftmscan.com"],balanceStorageSlot:1,type:"ERC1155"},ethereum:{contractAddress:"0x55485885e82E25446DEC314Ccb810Bda06B9e01B",chainId:1,name:"Ethereum",symbol:"ETH",decimals:18,balanceStorageSlot:1,type:"ERC1155",websocketUrl:"wss://mainnet.infura.io/ws/v3/ddf1ca3700f34497bca2bf03607fde38"},kovan:{contractAddress:"0xA9b2180C2A479Ba9b263878C4d81AE4e0E717846",chainId:42,name:"Ethereum",symbol:"ETH",decimals:18,rpcUrls:["https://kovan.infura.io/v3/ddf1ca3700f34497bca2bf03607fde38"],blockExplorerUrls:["https://kovan.etherscan.io"],balanceStorageSlot:1,type:"ERC20"}};function Z(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function X(e,t,n){if(!e.s){if(n instanceof te){if(!n.s)return void(n.o=X.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(X.bind(null,e,t),X.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var $=function(){try{var e=(new Date).toISOString(),t=ae.replace("{{timestamp}}",e);return Promise.resolve(function(e){var t=e.body;try{return Promise.resolve(oe()).then(function(e){var n=e.web3,r=e.account;return console.log("signing with ",r),Promise.resolve(n.request({method:"personal_sign",params:[r,t]})).then(function(e){var n=o.verifyMessage(t,e).toLowerCase();if(console.log("Signature: ",e),console.log("recovered address: ",n),n!==r){var a="ruh roh, the user signed with a different address ("+n+") then they're using with web3 ("+r+").  this will lead to confusion.";throw console.error(a),alert("something seems to be wrong with your wallets message signing.  maybe restart your browser or your wallet.  your recovered sig address does not match your web3 account address"),new Error(a)}return{signature:e,address:n}})})}catch(e){return Promise.reject(e)}}({body:t})).then(function(e){localStorage.setItem("lit-auth-signature",JSON.stringify({sig:e.signature,derivedVia:"web3.eth.personal.sign",signedMessage:t,address:e.address}));var n=A.default.box.keyPair();localStorage.setItem("lit-comms-keypair",JSON.stringify({publicKey:x.default.encodeBase64(n.publicKey),secretKey:x.default.encodeBase64(n.secretKey)})),console.log("generated and saved lit-comms-keypair")})}catch(e){return Promise.reject(e)}},ee=function(e){var t=e.chain;try{return Promise.resolve(oe()).then(function(e){var n=e.web3,r=e.account;return Promise.resolve(n.request({method:"eth_chainId",params:[]})).then(function(e){var o;function a(e){if(o)return e;function t(){n=JSON.parse(n);var e=function(){if(r!==n.address)return Promise.resolve($()).then(function(){n=localStorage.getItem("lit-auth-signature"),n=JSON.parse(n)})}();return e&&e.then?e.then(function(){return n}):n}var n=localStorage.getItem("lit-auth-signature"),a=function(){if(!n)return Promise.resolve($()).then(function(){n=localStorage.getItem("lit-auth-signature")})}();return a&&a.then?a.then(t):t()}var i=Q[t],s="0x"+i.chainId.toString("16");console.debug("checkAndSignAuthMessage with chainId "+e+" and chain set to "+t+" and selectedChain is ",i);var c=function(){if(e!==s)return 1!==i.chainId?Promise.resolve(n.request({method:"wallet_addEthereumChain",params:[{chainId:s,chainName:i.name,nativeCurrency:{name:i.name,symbol:i.symbol,decimals:i.decimals},rpcUrls:i.rpcUrls,blockExplorerUrls:i.blockExplorerUrls}]}).catch()).then(function(e){e&&console.log(e)}):(o=1,{errorCode:"wrong_chain"})}();return c&&c.then?c.then(a):a(c)})})}catch(e){return Promise.reject(e)}},te=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var a=1&o?t:n;if(a){try{X(r,1,a(this.v))}catch(e){X(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?X(r,1,t?t(o):o):n?X(r,1,n(o)):X(r,2,o)}catch(e){X(r,2,e)}},r},e}();function ne(e){return e instanceof te&&1&e.s}var re=function(e){var t=e.tokenAddress,n=e.balanceStorageSlot,r=e.tokenId;try{return console.log("getMerkleProof for { tokenAddress, balanceStorageSlot, tokenId } "+t+", "+n+", "+r),Promise.resolve(oe()).then(function(e){var o=e.web3,a=e.account;function i(){return{header:d,accountProof:l.accountProof,storageProof:l.storageProof[0].proof,blockHash:d.hash}}console.log("getting mappingAt("+n+", "+r+", "+a+")");var c=s.mappingAt(n,parseInt(r),a);console.log("storageAddress: ",c);var u=0,l=null,d=null,p=function(e,t,n){for(var r;;){var o=e();if(ne(o)&&(o=o.v),!o)return a;if(o.then){r=0;break}var a=n();if(a&&a.then){if(!ne(a)){r=1;break}a=a.s}}var i=new te,s=X.bind(null,i,2);return(0===r?o.then(u):1===r?a.then(c):(void 0).then(function(){(o=e())?o.then?o.then(u).then(void 0,s):u(o):X(i,1,a)})).then(void 0,s),i;function c(t){a=t;do{if(!(o=e())||ne(o)&&!o.v)return void X(i,1,a);if(o.then)return void o.then(u).then(void 0,s);ne(a=n())&&(a=a.v)}while(!a||!a.then);a.then(c).then(void 0,s)}function u(e){e?(a=n())&&a.then?a.then(c).then(void 0,s):c(a):X(i,1,a)}}(function(){return!l&&u<6},0,function(){var e=Z(function(){function e(){return Promise.resolve(o.request({method:"eth_getProof",params:[t,[c],d.number]})).then(function(e){l=e,console.log("rpcProof: ",l)})}var n=function(){if(!d)return Promise.resolve(o.request({method:"eth_getBlockByNumber",params:["latest",!1]})).then(function(e){d=e,console.log("rpcBlock: ",d)})}();return n&&n.then?n.then(e):e()},function(e){console.log(e),console.log("error getting rpc proof, have made "+u+" attempts"),u++});if(e&&e.then)return e.then(function(){})});return p&&p.then?p.then(i):i()})}catch(e){return Promise.reject(e)}},oe=function(){try{if(void 0===window.ethereum)throw new Error({errorCode:"no_wallet",message:"No web3 wallet was found"});return Promise.resolve(L.default()).then(function(e){return Promise.resolve(e.request({method:"eth_requestAccounts"})).then(function(t){var n=t[0].toLowerCase();return{web3:e,account:n}})})}catch(e){return Promise.reject(e)}},ae="I am creating an account to use LITs at {{timestamp}}";function ie(){return(ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var se=function(e){window.parent.postMessage(e,"*")};function ce(e){return new Promise(function(t,n){var r=new FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(e)})}function ue(e,t,n){if(!e.s){if(n instanceof de){if(!n.s)return void(n.o=ue.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(ue.bind(null,e,t),ue.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var le=function(e){var t=e.symmetricKey;try{var n=document.getElementById("mediaGridHolder"),r=document.getElementById("lockedHeader");return Promise.resolve(fetch(window.encryptedZipDataUrl)).then(function(e){return Promise.resolve(e.blob()).then(function(e){return Promise.resolve(fe(e,t)).then(function(e){return Promise.resolve(e["string.txt"].async("text")).then(function(e){n.innerHTML=e,r.innerText="UNLOCKED",window.locked=!1})})})})}catch(e){return Promise.reject(e)}},de=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var a=1&o?t:n;if(a){try{ue(r,1,a(this.v))}catch(e){ue(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?ue(r,1,t?t(o):o):n?ue(r,1,n(o)):ue(r,2,o)}catch(e){ue(r,2,e)}},r},e}(),pe=function(e){try{return Promise.resolve(e.generateAsync({type:"blob"})).then(function(e){return Promise.resolve(e.arrayBuffer()).then(function(t){return console.log("blob",e),Promise.resolve(function(){try{return Promise.resolve(crypto.subtle.generateKey(J,!0,["encrypt","decrypt"]))}catch(e){return Promise.reject(e)}}()).then(function(e){return Promise.resolve(function(e,t){try{var n=window.crypto.getRandomValues(new Uint8Array(16));return Promise.resolve(crypto.subtle.encrypt({name:"AES-CBC",iv:n},e,t)).then(function(e){return new Blob([n,new Uint8Array(e)],{type:"application/octet-stream"})})}catch(e){return Promise.reject(e)}}(e,t)).then(function(t){return Promise.resolve(crypto.subtle.exportKey("jwk",e)).then(function(e){return console.log("exportedSymmKey",e),{symmetricKey:JSON.stringify(e),encryptedZip:t}})})})})})}catch(e){return Promise.reject(e)}},fe=function(e,t){try{return Promise.resolve(function(e){try{return Promise.resolve(crypto.subtle.importKey("jwk",JSON.parse(e),J,!0,["encrypt","decrypt"]))}catch(e){return Promise.reject(e)}}(t)).then(function(t){return Promise.resolve(function(e,t){try{return Promise.resolve(e.slice(0,16).arrayBuffer()).then(function(n){return Promise.resolve(e.slice(16).arrayBuffer()).then(function(e){return Promise.resolve(crypto.subtle.decrypt({name:"AES-CBC",iv:n},t,e))})})}catch(e){return Promise.reject(e)}}(e,t)).then(function(e){var t=new I.default;return Promise.resolve(t.loadAsync(e)).then(function(e){return e.files})})})}catch(e){return Promise.reject(e)}},ye={},me=function(e){var t=e.tokenId,n=e.chain,r=e.tokenAddress.toLowerCase(),o=parseInt(t).toString(16).padStart(64,"0"),a=N.default(Buffer.from(r+"|"+o+"|"+n),"sha2-256");return new F.default(a).toString()},he=z.Request,ge=z.Response,ve=z.StoreKeyFragmentResponse,be=z.GetKeyFragmentResponse,we=function(){function e(e){if(void 0===e&&(e={alertWhenUnauthorized:!0,minNodeCount:6,bootstrapUrls:["/dns4/node1.litgateway.com/tcp/9090/https/p2p-webrtc-direct/p2p/12D3KooWK1KtaAV5rWjbAmZcd62VYSmEz1k81jzr87JAcSS7rKdQ","/dns4/node1.litgateway.com/tcp/9091/https/p2p-webrtc-direct/p2p/QmfLL5EqgyJKrD1oe8ZFGLM7HXGadGuQR9RqEeM1hBVqtP","/dns4/node1.litgateway.com/tcp/9092/https/p2p-webrtc-direct/p2p/Qmeo7u9goqqKA3Fkj7VmT7EkpgtjZK6DaJBWYBGW5czo2A","/dns4/node1.litgateway.com/tcp/9093/https/p2p-webrtc-direct/p2p/QmVVtPgZWPNUmcPf57PWjij1kosrZhbHNgrMwkog1Eyn1H","/dns4/node1.litgateway.com/tcp/9094/https/p2p-webrtc-direct/p2p/QmRae8zUD7vdQjf4cAegtuFX78BfrWmdhdsVaWN9VDVFs9","/dns4/node1.litgateway.com/tcp/9095/https/p2p-webrtc-direct/p2p/QmU7e6JrtVt6PnpShJkdaN9W68eVX9JRxYxo9nVLupUGtG","/dns4/node1.litgateway.com/tcp/9096/https/p2p-webrtc-direct/p2p/QmZK4A6CRL8gcsooCpiWuxkguXJartbGDizjs7f11ALevm","/dns4/node1.litgateway.com/tcp/9097/https/p2p-webrtc-direct/p2p/QmUA9MUPs3eG7vcuQvZzwWEodzdW7xaDFyanpmuwjWEMk1","/dns4/node1.litgateway.com/tcp/9098/https/p2p-webrtc-direct/p2p/QmYJpEuUaojzYhWXShH29xQzXbJoS2YyKyEdkKP77nK1Q4","/dns4/node1.litgateway.com/tcp/9099/https/p2p-webrtc-direct/p2p/QmeJiT66sYz4P9y44W1LaoWjw42AefFxJnagyDCNpJys1w"]}),this.config=e,this.libp2p=null,this.connectedNodes=new Set,this.serverPubKeys={},this.ready=!1,"undefined"!=typeof window&&window&&window.localStorage){var t=window.localStorage.getItem("LitNodeClientConfig");t&&(t=JSON.parse(t)),this.config=ie({},e,t)}}var t=e.prototype;return t.getEncryptionKey=function(e){var t=e.tokenAddress,n=e.tokenId,r=e.chain,o=e.authSig,a=e.merkleProof;try{var i=this;return Promise.resolve(i.getEncryptionKeyFragments({tokenAddress:t,tokenId:n,authSig:o,chain:r,merkleProof:a})).then(function(e){if(e.some(function(e){return"AUTH_FAILURE"===e}))return i.config.alertWhenUnauthorized&&alert("You are not authorized to unlock to this LIT"),document.dispatchEvent(new Event("lit-authFailure")),null;for(var t=JSON.parse(localStorage.getItem("lit-comms-keypair")),n=[],r=0;r<e.length;r++)if(e[r].error)console.log("kFrag number "+r+" has an error",e[r].error);else{var o=Y(JSON.parse(e[r]),t.secretKey);n.push(o)}var a=O.default.combine(n);return G.default(D.default(a,"base16"))})}catch(e){return Promise.reject(e)}},t.saveEncryptionKey=function(e){var t=e.tokenAddress,n=e.tokenId,r=e.chain,o=e.authSig,a=e.symmetricKey,i=e.merkleProof;try{var s=this,c=Array.from(s.connectedNodes),u=c.length,l=G.default(D.default(a),"base16");console.debug("splitting up into "+u+" shares with a threshold of 3");var d=O.default.share(l,u,3);if(d.length!==c.length)throw new Error("kFrags.length ("+d.length+") !== nodes.length ("+c.length+")");for(var p=[],f=t.toLowerCase(),y=0;y<c.length;y++){var m=c[y];console.debug("storing kFrag in node "+(y+1)+" of "+c.length);var h=x.default.encodeBase64(s.serverPubKeys[m]),g=JSON.stringify(W(h,d[y],"x25519-xsalsa20-poly1305"));p.push(s.storeDataWithNode({peerId:m,tokenAddress:f,tokenId:n,fragmentNumber:y,val:g,authSig:o,chain:r,merkleProof:i}).catch(function(e){return{error:e}}))}return Promise.resolve(Promise.all(p)).then(function(e){if(e.some(function(e){return"AUTH_FAILURE"===e}))return s.config.alertWhenUnauthorized&&alert("You are not authorized to publish to this LIT"),document.dispatchEvent(new Event("lit-authFailure")),{success:!1};var t=e.filter(function(e){return!1===e||e.error}).length;return console.log("bad resp count",t),u-t<s.config.minNodeCount?(alert("An error occurred and your LIT was not stored.  Please try again."),document.dispatchEvent(new Event("lit-storageFailure")),{success:!1}):(console.log("all stored: ",e),{success:!0})})}catch(e){return Promise.reject(e)}},t.getEncryptionKeyFragments=function(e){var t=e.tokenAddress,n=e.tokenId,r=e.authSig,o=e.chain,a=e.merkleProof;try{var i=this,s=t.toLowerCase(),c=me({tokenAddress:t,tokenId:n,chain:o}),u=new F.default(c);return Promise.resolve(H.default(i.libp2p.contentRouting.findProviders(u,{timeout:6e4}))).then(function(e){console.log("Found "+e.length+" providers");for(var t=[],u=0;u<e.length;u++){var l=e[u].id.toB58String();console.debug("Getting "+c+" from "+l),t.push(i.getDataFromNode({peerId:l,tokenAddress:s,tokenId:n,authSig:r,keyId:c,chain:o,merkleProof:a}).catch(function(e){return{error:e}}))}return Promise.resolve(Promise.all(t))})}catch(e){return Promise.reject(e)}},t.storeDataWithNode=function(e){var t=e.peerId,n=e.tokenAddress,r=e.tokenId,o=e.fragmentNumber,a=e.val,i=e.authSig,s=e.chain,c=e.merkleProof;try{console.debug("storing data with node "+t+" with tokenAddress "+n+" and tokenId "+r);var u=he.encode({type:he.Type.STORE_KEY_FRAGMENT,storeKeyFragment:{fragmentValue:D.default(a),fragmentNumber:D.default(o)},authSig:D.default(JSON.stringify(i)),tokenParams:{tokenAddress:D.default(n),tokenId:D.default(r.toString()),chain:D.default(s)},merkleProof:D.default(JSON.stringify(c))});return Promise.resolve(this.sendCommandToPeer({peerId:t,data:u}))}catch(e){return Promise.reject(e)}},t.getDataFromNode=function(e){var t=e.peerId,n=e.tokenAddress,r=e.tokenId,o=e.keyId,a=e.authSig,i=e.chain,s=e.merkleProof;try{console.debug("getDataFromNode "+t+" with keyId "+o);var c=JSON.parse(localStorage.getItem("lit-comms-keypair")),u=he.encode({type:he.Type.GET_KEY_FRAGMENT,getKeyFragment:{keyId:D.default(o)},authSig:D.default(JSON.stringify(a)),tokenParams:{tokenAddress:D.default(n),tokenId:D.default(r.toString()),chain:D.default(i)},clientPubKey:x.default.decodeBase64(c.publicKey),merkleProof:D.default(JSON.stringify(s))});return Promise.resolve(this.sendCommandToPeer({peerId:t,data:u}))}catch(e){return Promise.reject(e)}},t.handshakeWithSgx=function(e){var t=e.peerId;try{console.debug("handshakeWithSgx "+t);var n=he.encode({type:he.Type.HANDSHAKE});return Promise.resolve(this.sendCommandToPeer({peerId:t,data:n}))}catch(e){return Promise.reject(e)}},t.sendCommandToPeer=function(e){var t=e.peerId,n=e.data;try{var r=this,o=r.libp2p.connectionManager.get(M.default.createFromB58String(t));return Promise.resolve(o.newStream(["/lit/1.0.0"])).then(function(e){var o=e.stream;console.debug("sendCommandToPeer "+t);var a=null;return Promise.resolve(q.default([n],o,function(e){try{return console.debug("in sendCommandToPeer callback"),Promise.resolve(e.next()).then(function(e){var n=ge.decode(e.value.slice());n.type===ge.Type.HANDSHAKE_RESPONSE?(r.serverPubKeys[t]=n.serverPubKey,console.log("handshake success for "+t+" - got server pub key "+x.default.encodeBase64(n.serverPubKey)),a=!0):n.type===ge.Type.STORE_KEY_FRAGMENT_RESPONSE?n.storeKeyFragmentResponse.result===ve.Result.SUCCESS?(console.log("success storing key fragment"),a=!0):n.storeKeyFragmentResponse.result===ve.Result.AUTH_FAILURE?(console.log("auth failure.  user doesnt own token"),a="AUTH_FAILURE"):(console.log("error storing key fragment: "),console.log(G.default(n.storeKeyFragmentResponse.errorMessage)),a=!1):n.type===ge.Type.GET_KEY_FRAGMENT_RESPONSE?n.getKeyFragmentResponse.result===be.Result.SUCCESS?(console.log("success getting key fragment"),a=G.default(n.getKeyFragmentResponse.fragmentValue)):n.getKeyFragmentResponse.result===be.Result.NOT_FOUND?(console.log("key fragment not found"),a=!1):n.getKeyFragmentResponse.result===be.Result.AUTH_FAILURE?(console.log("auth failure.  user doesnt own token"),a="AUTH_FAILURE"):(console.log("unknown error getting key fragment"),a=!1):console.log("unknown response type")})}catch(e){return Promise.reject(e)}})).then(function(){return a})})}catch(e){return Promise.reject(e)}},t.connect=function(){try{var e,t=this;return Promise.resolve(C.default.create({modules:{transport:[j.default,R.default],connEncryption:[y.NOISE],streamMuxer:[B.default],dht:_.default,peerDiscovery:[U.default]},transportManager:{faultTolerance:m.FaultTolerance.NO_FATAL},config:{dht:{enabled:!0},peerDiscovery:(e={},e[U.default.tag]={enabled:!0,list:t.config.bootstrapUrls},e)}})).then(function(e){return t.libp2p=e,t.libp2p.on("peer:discovery",function(e){console.debug("Found peer "+e.toB58String())}),t.libp2p.connectionManager.on("peer:connect",function(e){try{var n=e.remotePeer.toB58String();return console.debug("Connected to "+n),t.connectedNodes.has(n)||(t.connectedNodes.add(n),setTimeout(function(){try{return Promise.resolve(t.handshakeWithSgx({peerId:n})).then(function(){})}catch(e){return Promise.reject(e)}},500)),Promise.resolve()}catch(e){return Promise.reject(e)}}),t.libp2p.connectionManager.on("peer:disconnect",function(e){var n=e.remotePeer.toB58String();console.debug("Disconnected from "+n),t.connectedNodes.delete(n)}),Promise.resolve(t.libp2p.start()).then(function(){console.debug("libp2p id is "+t.libp2p.peerId.toB58String()),t.libp2p.multiaddrs.forEach(function(e){return console.debug(e.toString()+"/p2p/"+t.libp2p.peerId.toB58String())});var e=window.setInterval(function(){Object.keys(t.serverPubKeys).length>=t.config.minNodeCount&&(clearInterval(e),t.ready=!0,console.debug("lit is ready"),document.dispatchEvent(new Event("lit-ready")))},500);window.libp2p=t.libp2p,window.PeerId=M.default})})}catch(e){return Promise.reject(e)}},e}();"undefined"!=typeof window&&(function(){try{return window.self!==window.top}catch(e){return!0}}()?function(){try{console.log("calling listenForFrameParentMessages from "+window.origin),window.addEventListener("message",function(e){try{var t=e.source===window.parent;if(t&&console.log("onMessage in frame: ",e),t){var n=e.data,r=n.respondingToCommand;if("LIT_ACK"===n.response)return window.useLitPostMessageProxy=!0,Promise.resolve();"getEncryptionKey"===r&&le({symmetricKey:e.data.encryptionKey})}return Promise.resolve()}catch(e){return Promise.reject(e)}},!1),Promise.resolve()}catch(e){return Promise.reject(e)}}():function(){try{console.log("calling listenForChildFrameMessages from "+window.origin),window.addEventListener("message",function(e){try{for(var t=!1,n=0;n<frames.length;n++)frames[n]===e.source&&(t=n);return Promise.resolve(function(){if(!1!==t){console.log("onMessage in parent: ",e);var n=e.data,r=n.command,o=n.params;if("LIT_SYN"===r)return void window.frames[t].postMessage({response:"LIT_ACK"},"*");var a=function(){if("LitNodeClient"===e.data.target){var n=function(){if("getEncryptionKey"===r)return Promise.resolve(window.litNodeClient.getEncryptionKey(ie({},o))).then(function(e){window.frames[t].postMessage({respondingToCommand:r,encryptionKey:e},"*")})}();if(n&&n.then)return n.then(function(){})}}();if(a&&a.then)return a.then(function(){})}}())}catch(e){return Promise.reject(e)}},!1),Promise.resolve()}catch(e){return Promise.reject(e)}}()),module.exports={zipAndEncryptString:function(e){try{var t=new I.default;return t.file("string.txt",e),pe(t)}catch(e){return Promise.reject(e)}},zipAndEncryptFiles:function(e){try{for(var t=new I.default,n=0;n<e.length;n++)t.folder("encryptedAssets").file(e[n].name,e[n]);return pe(t)}catch(e){return Promise.reject(e)}},encryptZip:pe,decryptZip:fe,connectWeb3:oe,checkAndSignAuthMessage:ee,createHtmlLIT:function(e){var t,n,r,o,a,i=e.title,s=e.htmlBody,c=e.css,u=e.encryptedZipDataUrl,l=e.tokenAddress,d=e.tokenId,p=e.chain,f=e.npmPackages,y=void 0===f?[]:f;try{var m="",h=(t=y,n=function(e){return Promise.resolve(function(e){try{return ye[e]?Promise.resolve(ye[e]):Promise.resolve(fetch("https://unpkg.com/"+e)).then(function(t){if(!t.ok)throw console.log("error with response: ",t),Error(t.statusText);return Promise.resolve(t.blob()).then(function(t){return Promise.resolve(ce(t)).then(function(t){return ye[e]=t,t})})})}catch(e){return Promise.reject(e)}}(y[e])).then(function(e){m+='<script src="'+e+'"><\/script>\n'})},a=-1,function e(i){try{for(;++a<t.length;)if((i=n(a))&&i.then){if(!((s=i)instanceof de&&1&s.s))return void i.then(e,o||(o=ue.bind(null,r=new de,2)));i=i.v}r?ue(r,1,i):r=i}catch(e){ue(r||(r=new de),2,e)}var s}(),r);return Promise.resolve(h&&h.then?h.then(function(){return"\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>"+i+'</title>\n    <style id="jss-server-side">'+c+"</style>\n    "+m+'\n    <script>\n      var encryptedZipDataUrl = "'+u+'"\n      var tokenAddress = "'+l+'"\n      var tokenId = "'+d+'"\n      var chain = "'+p+"\"\n      var locked = true\n      var useLitPostMessageProxy = false\n\n      document.addEventListener('lit-ready', function(){\n        var unlockButton = document.getElementById('unlockButton')\n        if (unlockButton) {\n          unlockButton.disabled = false\n        }\n\n        var loadingSpinner = document.getElementById('loadingSpinner')\n        if (loadingSpinner) {\n          loadingSpinner.style = 'display: none;'\n        }\n\n        var loadingText = document.getElementById('loadingText')\n        if (loadingText){\n          loadingText.innerText = ''\n        }\n      })\n    <\/script>\n    <script onload='LitJsSdk.default.litJsSdkLoadedInALIT()' src=\"https://jscdn.litgateway.com/index.web.js\"><\/script>\n  </head>\n  <body>\n    <div id=\"root\">"+s+"</div>\n    <script>\n      var unlockButton = document.getElementById('unlockButton')\n      unlockButton.onclick = function() {\n        LitJsSdk.default.toggleLock()\n      }\n      unlockButton.disabled = true\n    <\/script>\n  </body>\n</html>\n  "}):"\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>"+i+'</title>\n    <style id="jss-server-side">'+c+"</style>\n    "+m+'\n    <script>\n      var encryptedZipDataUrl = "'+u+'"\n      var tokenAddress = "'+l+'"\n      var tokenId = "'+d+'"\n      var chain = "'+p+"\"\n      var locked = true\n      var useLitPostMessageProxy = false\n\n      document.addEventListener('lit-ready', function(){\n        var unlockButton = document.getElementById('unlockButton')\n        if (unlockButton) {\n          unlockButton.disabled = false\n        }\n\n        var loadingSpinner = document.getElementById('loadingSpinner')\n        if (loadingSpinner) {\n          loadingSpinner.style = 'display: none;'\n        }\n\n        var loadingText = document.getElementById('loadingText')\n        if (loadingText){\n          loadingText.innerText = ''\n        }\n      })\n    <\/script>\n    <script onload='LitJsSdk.default.litJsSdkLoadedInALIT()' src=\"https://jscdn.litgateway.com/index.web.js\"><\/script>\n  </head>\n  <body>\n    <div id=\"root\">"+s+"</div>\n    <script>\n      var unlockButton = document.getElementById('unlockButton')\n      unlockButton.onclick = function() {\n        LitJsSdk.default.toggleLock()\n      }\n      unlockButton.disabled = true\n    <\/script>\n  </body>\n</html>\n  ")}catch(e){return Promise.reject(e)}},mintLIT:function(e){var t=e.chain,n=e.quantity;try{return console.log("minting "+n+" tokens on "+t),Promise.resolve(Z(function(){return Promise.resolve(ee({chain:t})).then(function(e){return e.errorCode?e:Promise.resolve(oe()).then(function(o){var i=o.account,s=Q[t].contractAddress,c=new r.Contract(s,V,new a.Web3Provider(o.web3).getSigner());return console.log("sending to chain..."),Promise.resolve(c.mint(n)).then(function(t){return console.log("sent to chain.  waiting to be mined..."),Promise.resolve(t.wait()).then(function(t){console.log("txReceipt: ",t);var n=t.events[0].args[3].toNumber();return{txHash:t.transactionHash,tokenId:n,tokenAddress:s,mintingAddress:i,authSig:e}})})})})},function(e){return console.log(e),4001===e.code?(console.log("User rejected request"),{errorCode:"user_rejected_request"}):(console.error(e),{errorCode:"unknown_error"})}))}catch(e){return Promise.reject(e)}},toggleLock:function(){try{var e=document.getElementById("mediaGridHolder"),t=document.getElementById("lockedHeader");return Promise.resolve(function(){if(window.locked)return window.publicContent=e.innerHTML,window.useLitPostMessageProxy||window.litNodeClient.ready?Promise.resolve(ee({chain:window.chain})).then(function(e){var t;function n(n){return t?n:window.useLitPostMessageProxy?void se({command:"getEncryptionKey",target:"LitNodeClient",params:{tokenAddress:window.tokenAddress,tokenId:window.tokenId,chain:window.chain,authSig:e,merkleProof:o}}):Promise.resolve(window.litNodeClient.getEncryptionKey({tokenAddress:window.tokenAddress,tokenId:window.tokenId,authSig:e,chain:window.chain,merkleProof:o})).then(function(e){return Promise.resolve(le({symmetricKey:e})).then(function(){})})}if(!e.errorCode||"wrong_chain"!==e.errorCode){var r=Q[window.chain].balanceStorageSlot,o=null,a=function(e,t){try{var n=Promise.resolve(re({tokenAddress:window.tokenAddress,balanceStorageSlot:r,tokenId:window.tokenId})).then(function(e){o=e})}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}(0,function(e){console.log(e),alert("Error - could not obtain merkle proof.  Some nodes do not support this operation yet.  Please try another ETH node."),t=1});return a&&a.then?a.then(n):n(a)}alert("You are connected to the wrong blockchain.  Please switch your metamask to "+window.chain)}):void alert("The LIT network is still connecting.  Please try again in about 10 seconds.");e.innerHTML=window.publicContent,t.innerText="LOCKED",window.locked=!0}())}catch(e){return Promise.reject(e)}},LIT_CHAINS:Q,LitNodeClient:we,protobufs:z,kFragKey:me,encryptWithPubKey:W,decryptWithPrivKey:Y,fileToDataUrl:ce,getMerkleProof:re,findLITs:function(){try{return console.log("findLITs"),Promise.resolve(Z(function(){return Promise.resolve(oe()).then(function(e){var t=e.web3,n=e.account;return Promise.resolve(t.request({method:"eth_chainId",params:[]})).then(function(e){var o=function(e){for(var t=0;t<Object.keys(Q).length;t++){var n=Object.keys(Q)[t];if("0x"+Q[n].chainId.toString("16")===e)return n}}(e),i=new r.Contract(Q[o].contractAddress,V,new a.Web3Provider(t).getSigner());return console.log("getting maxTokenid"),Promise.resolve(i.tokenIds()).then(function(e){for(var t=[],r=[],a=0;a<=e;a++)t.push(n),r.push(a);return console.log("getting balanceOfBatch"),Promise.resolve(i.balanceOfBatch(t,r)).then(function(e){return{tokenIds:e.map(function(e,t){return 0===e.toNumber()?null:t}).filter(function(e){return null!==e}),chain:o}})})})})},function(e){return console.log(e),4001===e.code?(console.log("User rejected request"),{errorCode:"user_rejected_request"}):(console.error(e),{errorCode:"unknown_error"})}))}catch(e){return Promise.reject(e)}},sendLIT:function(e){var t=e.tokenMetadata,n=e.to;try{return console.log("sendLIT for ",t),Promise.resolve(Z(function(){return Promise.resolve(oe()).then(function(e){var o=e.account,i=t.tokenId,s=new r.Contract(t.tokenAddress,V,new a.Web3Provider(e.web3).getSigner());return console.log("transferring"),Promise.resolve(s.safeTransferFrom(o,n,i,1,[])).then(function(e){return console.log("sent to chain"),{success:!0}})})},function(e){return console.log(e),4001===e.code?(console.log("User rejected request"),{errorCode:"user_rejected_request"}):(console.error(e),{errorCode:"unknown_error"})}))}catch(e){return Promise.reject(e)}},litJsSdkLoadedInALIT:function(){se({command:"LIT_SYN"}),setTimeout(function(){if(window.useLitPostMessageProxy)console.log("inside lit - parent frame is connected to lit nodes.  using that.");else{console.log("inside lit - no parent frame lit node connection.  connecting ourselves.");var e=new we;e.connect(),window.litNodeClient=e}},1e3)},unlockLitWithKey:le,injectViewerIFrame:function(e){var t=e.destinationId,n=e.title,r=e.fileUrl,o=e.className;if(r.includes("data:"))throw new Error("You can not inject an iFrame with a data url.  Try a regular https URL.");if(new URL(r).host.toLowerCase()===window.location.host.toLowerCase())throw new Error("You cannot host a LIT on the same domain as the parent webpage.  This is because iFrames with the same origin have access to localstorage and cookies in the parent webpage which is unsafe");var a=document.createElement("iframe");a.src=r,a.title=n,a.sandbox="allow-forms allow-scripts allow-popups  allow-modals allow-popups-to-escape-sandbox allow-same-origin",a.loading="lazy",a.allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; display-capture; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr; screen-wake-lock; web-share; xr-spatial-tracking",o&&(a.className=o),document.getElementById(t).appendChild(a)},printError:function(e){console.log("Error Stack",e.stack),console.log("Error Name",e.name),console.log("Error Message",e.message)}};
//# sourceMappingURL=index.js.map
